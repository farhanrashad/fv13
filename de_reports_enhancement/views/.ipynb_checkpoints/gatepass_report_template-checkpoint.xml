<odoo>
    <template id="gatepass_report">
        <t t-call="web.html_container">
        <t t-call="web.external_layout">
            <t t-foreach="docs" t-as="o">
                <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
                <t t-set="partner" t-value="o.partner_id or (o.move_lines and o.move_lines[0].partner_id) or False"/>
                <t t-if="partner" name="partner_header">
                    <t t-set="address">
                        <div t-esc="partner" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True}"/>
                    </t>
                </t>
                <div class="page">
                    <div class="row justify-content-end" t-if="o.sudo().sale_id.client_order_ref">
                        <div class="col-4">
                            <strong>Customer Reference:</strong>
                            <p t-field="o.sudo().sale_id.client_order_ref"/>
                        </div>
                    </div>
                    <h3 class="text-center">
                        Gatepass No. 
                        <span t-field="o.name"/>
                    </h3>
                    <div class="row mt32 mb32">
                        <div t-if="o.name" class="col-auto">
                            <t t-if="o.picking_type_code == 'outgoing'">
                                <strong>Delivery No.:</strong>
                            </t>
                            <t t-if="o.picking_type_code == 'incoming'">
                                <strong>Receipt No.:</strong>
                            </t>
                            <p t-field="o.name"/>
                        </div>
                        <div t-if="o.origin" class="col-auto">
                            <strong>Order:</strong>
                            <p t-field="o.origin"/>
                        </div>
                        <div t-if="o.state" class="col-auto" name="div_sched_date">
                            <strong>Shipping Date:</strong>
                            <t t-if="o.state == 'done'">
                                <p t-field="o.date_done" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                            </t>
                            <t t-if="o.state != 'done'">
                                <p t-field="o.scheduled_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                            </t>
                        </div>
                        <div t-if="o.gatepass_no" class="col-auto">
                            <strong>Manual Gatepass</strong>
                            <p t-field="o.gatepass_no"/>
                        </div>
                        <div t-if="o.driver_name" class="col-auto">
                            <strong>Driver</strong>
                            <p t-field="o.driver_name"/>
                        </div>
                        <div t-if="o.vehicle_no" class="col-auto">
                            <strong>Vehicle No.:</strong>
                            <p t-field="o.vehicle_no"/>
                        </div>
                    </div>
                    <table class="table table-sm" name="stock_move_table">
                        <thead>
                            <tr>
                                <th>
                                    <strong>Product</strong>
                                </th>
                                <th colspan="2">
                                    <span>Quantity</span>
                                </th>
                                <th>
                                    <span>Lots</span>
                                </th>
                                <!--
                                <th><span>Unit Weight</span></th>
-->
                                <th>
                                    <span>Total Weight</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                            <tr t-foreach="lines" t-as="move">
                                <td>
                                    <span t-field="move.product_id"/>
                                    <p t-if="o.picking_type_code == 'outgoing'">
                                        <span t-field="move.product_id.sudo().description_pickingout"/>
                                    </p>
                                    <p t-if="o.picking_type_code == 'incoming'">
                                        <span t-field="move.product_id.sudo().description_pickingin"/>
                                    </p>
                                </td>
                                <td>
                                    <span t-field="move.quantity_done"/>
                                    <span t-field="move.product_uom"/>
                                </td>
                                <td>
                                    <t t-if="not move.product_id.uom_id == move.product_id.uom_po_id">
                                        <t t-if="move.product_id.uom_po_id.uom_type == 'bigger'">
                                            <span t-esc="round(move.quantity_done / move.product_id.uom_po_id.factor_inv,3)"/>
                                            <span t-esc="move.product_id.uom_po_id.name"/>
                                        </t>
                                        <t t-if="move.product_id.uom_po_id.uom_type == 'smaller'">
                                            <span t-esc="round(move.quantity_done * move.product_id.uom_po_id.factor_inv,3)"/>
                                            <span t-esc="move.product_id.uom_po_id.name"/>
                                        </t>
                                    </t>
                                </td>
                                <t t-set="lot" t-value="0"/>
                                <t t-set="tw" t-value="0"/>
                                <t t-foreach="move.move_line_ids" t-as="move_line">
                                    <t t-if="move_line.lot_id">
                                        <t t-set="lot" t-value="lot+1"/>
                                        <t t-set="tw" t-value="tw+move_line.total_weight"/></t>
                                </t>
                                <td>
                                    <span t-esc="lot"/>
                                </td>
                                <t t-if="move.product_id.product_tmpl_id.is_weight_uom">
                                    <td>
                                        <t t-if="move.total_weight == 0">
                                            <span t-esc="tw"/>
                                        </t>
                                        <t t-else="">
                                            <span t-field="move.total_weight"/> Kg
                                    
                                        </t>
                                    </td>
                                </t>
                            </tr>
                        </tbody>
                    </table>
                    <div class="clearfix" name="so_total_summary">
                        <div id="total" class="row" name="total">
                            <div>
                                <table class="table table-sm">
                                    <tr class="border-black o_subtotal" style="">
                                        <td>
                                            <strong>Total Quantity</strong>
                                        </td>
                                        <td>
                                            <span class="m-0" t-field="o.sum_qty"/>
                                        </td>
                                    </tr>
                                    <tr class="border-black o_subtotal" style="">
                                        <td>
                                            <strong>Total Weight</strong>
                                        </td>
                                        <td>
                                            <span class="m-0" t-field="o.sum_weight"/> Kg
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <p>
                        <t t-if="o.backorder_ids and o.backorder_ids.filtered(lambda x: x.state not in ('done', 'cancel'))">
                            All items couldn't be shipped, the remaining ones will be shipped as soon as they become available.
                        </t>
                    </p>
                </div>
                <div>
                    <t t-if="o.note">
                        <p t-field="o.note"/>
                    </t>
                </div>
                <br/>
                <br/>
                <div class="row col mt32 mb32" id="informations">
                    <div class="col-3" style="border-top:1px solid #000000;">
                Prepared By
            </div>
                    <div class="col-3" style="margin-left:20px;border-top:1px solid #000000;">
                Manager
            </div>
                    <div class="col-3" style="margin-left:20px;border-top:1px solid #000000;">
                Finance Manager
            </div>
                    <div class="col-3" style="margin-left:20px;border-top:1px solid #000000;">
                Authorized By
            </div>
                </div>
            </t>
        </t>
    </t>
    </template>
    <report id="action_print_gatepass_report"
            model="stock.picking"
            string="Gatepass"
            report_type="qweb-pdf"
            name="de_reports_enhancement.gatepass_report"
            file="de_reports_enhancement.gatepass_report"
            attachment_use="True"
    />
</odoo>